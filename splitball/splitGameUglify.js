function shuffle(a){for(var c,d,b=a.length;0!==b;)d=Math.floor(Math.random()*b),b-=1,c=a[b],a[b]=a[d],a[d]=c;return a}var Game=new function(){var a=[],b=!1,c=null,d=null;this.initialize=function(a,b,c){if(this.canvas=document.getElementById(a),this.width=this.canvas.width,this.height=this.canvas.height,this.offset1=this.canvas.offsetLeft,this.ctx=this.canvas.getContext&&this.canvas.getContext("2d"),!this.ctx)return alert("Please upgrade your browser to play");this.canvasMultiplier=1,this.playerOffset=10,this.isMobile=!1,this.setupMobile(),this.setupInput(),this.isMobile,this.animationLoop,function(){var a=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame;window.requestAnimationFrame=a}(),function(){var a=window.cancelAnimationFrame||window.cancelRequestAnimationFrame||window.cancelRequestAnimationFrame||window.cancelRequestAnimationFrame;window.cancelAnimationFrame=a}(),window.requestAnimationFrame?(window.requestAnimationFrame(loopRAF),this.animationLoop="RAF"):(this.loop(),this.animationLoop="Timeout");var d=navigator.platform;("iPad"===d||"iPhone"===d||"iPod"===d)&&(iOS=!0),SpriteSheet.load(b,c)};var e={37:"left",39:"right",32:"fire"};this.keys={},this.setupInput=function(){window.addEventListener("keydown",function(a){e[event.keyCode]&&(Game.keys[e[event.keyCode]]=!0,a.preventDefault())},!1),window.addEventListener("keyup",function(a){e[event.keyCode]&&(Game.keys[e[event.keyCode]]=!1,a.preventDefault())},!1)},this.loop=function(){var b=.03;Game.ctx.clearRect(0,0,Game.width,Game.height);for(var c=0,d=a.length;d>c;c++)a[c]&&(a[c].step(b),a[c].draw(Game.ctx));setTimeout(Game.loop,30)},loopRAF=function(c){var e=(c-d)/1e3;d=c,Game.ctx.clearRect(0,0,Game.width,Game.height);for(var f=0,g=a.length;g>f;f++)a[f]&&(a[f].step(e),a[f].draw(Game.ctx));b||window.requestAnimationFrame(loopRAF)},this.stopLoopFunc=function(){b=!0,c&&window.cancelAnimationFrame(c)},this.startLoopFunc=function(){b=!1,window.requestAnimationFrame(loopRAF)},this.narisiNekaj=function(){Game.ctx.fillStyle="#888888",Game.ctx.textAlign="left",Game.ctx.font="bold 15px bangers",Game.ctx.fillText("RI\u0160EMO NEKAJ!!!",5,20)},this.setBoard=function(b,c){a[b]=c},this.clearBoard=function(){a=[]},this.setupMobile=function(){var a=document.getElementById("container"),b=!!("ontouchstart"in window),c=window.innerWidth,d=window.innerHeight;if(b&&(mobile=!0,this.isMobile=!0),screen.width>=1280||!b)return!1;if(c>d&&(alert("Please rotate the device and then click OK"),c=window.innerWidth,d=window.innerHeight),a.style.height=2*d+"px",window.scrollTo(0,1),d=window.innerHeight+2,a.style.height=d+"px",a.style.width=c+"px",a.style.padding=0,d>=1.15*this.canvas.height||c>=1.15*this.canvas.height){var e=c/this.canvas.width;this.canvasMultiplier=e,this.canvas.width=c/e,this.canvas.height=d/e,this.canvas.style.width=c+"px",this.canvas.style.height=d+"px"}else this.canvas.width=c,this.canvas.height=d;this.canvas.style.position="absolute",this.canvas.style.left="0px",this.canvas.style.top="0px"}},SpriteSheet=new function(){this.map={},this.load=function(a,b){this.map=a,this.image=new Image,this.image.onload=b,this.image.src="images/mysprites.png"},this.draw=function(a,b,c,d,e){var f=this.map[b];e||(e=0),a.drawImage(this.image,f.sx+e*f.w,f.sy,f.w,f.h,Math.floor(c),Math.floor(d),f.w,f.h)}},GameBoard=function(){var a=this;this.objects=[],this.add=function(a){return a.board=this,this.objects.push(a),a},this.remove=function(a){this.removed.push(a)},this.alreadyRemoved=function(a){for(var b=0,c=this.removed.length;c>b;b++)if(a==this.removed[b])return!0;return!1},this.resetRemoved=function(){this.removed=[]},this.finalizeRemoved=function(){for(var a=0,b=this.removed.length;b>a;a++){var c=this.objects.indexOf(this.removed[a]);-1!=c&&this.objects.splice(c,1)}},this.iterate=function(a){for(var b=Array.prototype.slice.call(arguments,1),c=0,d=this.objects.length;d>c;c++){var e=this.objects[c];e[a].apply(e,b)}},this.detect=function(a){for(var b=0,d=this.objects.length;d>b;b++)if(a.call(this.objects[b]))return this.objects[b];return!1},this.step=function(a){this.resetRemoved(),this.iterate("step",a),this.finalizeRemoved()},this.draw=function(a){this.iterate("draw",a)},this.overlap=function(a,b){return!(a.y+a.h-1<b.y||a.y>b.y+b.h-1||a.x+a.w-1<b.x||a.x>b.x+b.w-1)},this.collide=function(b,c){return this.detect(function(){if(b!=this){var d=(!c||this.type&c)&&a.overlap(b,this);return d?this:!1}})}},TouchControls=function(){var a=10,b=Game.width/5,c=b-a;this.drawSquare=function(a,d,e,f,g){a.globalAlpha=g?.6:1,a.fillStyle="#555",a.fillRect(d,e,c,c),a.fillStyle="#333",a.fillRect(d+5,e+5,c-10,c-10),a.fillStyle="#FFF",a.textAlign="center",a.textBaseline="middle",a.globalAlpha=1,a.font="bold "+3*b/4+"px arial",a.fillText(f,d+c/2,e+c/2)},this.draw=function(c){c.save();var d=Game.height-b;this.drawSquare(c,a,d,"<",Game.keys.left),this.drawSquare(c,b+a,d,">",Game.keys.right),this.drawSquare(c,4*b,d,"x",Game.keys.fire),c.restore()},this.step=function(){},this.trackTouch=function(a){var c,d;a.preventDefault(),Game.keys.left=!1,Game.keys.right=!1;for(var e=0;e<a.targetTouches.length;e++)c=a.targetTouches[e],d=c.pageX/Game.canvasMultiplier-Game.canvas.offsetLeft,b>d&&(Game.keys.left=!0),d>b&&2*b>d&&(Game.keys.right=!0);if("touchstart"==a.type||"touchend"==a.type)for(e=0;e<a.changedTouches.length;e++)c=a.changedTouches[e],d=c.pageX/Game.canvasMultiplier-Game.canvas.offsetLeft,d>4*b&&(Game.keys.fire="touchstart"==a.type)},Game.canvas.addEventListener("touchstart",this.trackTouch,!0),Game.canvas.addEventListener("touchmove",this.trackTouch,!0),Game.canvas.addEventListener("touchend",this.trackTouch,!0),Game.playerOffset=b+5},HomeScreen=function(a){this.timeout=0,this.waitTime=3,this.step=function(b){this.timeout+=b,this.waitTime-=b,this.timeout>3&&a()},this.draw=function(a){a.fillStyle="#FFFFFF",a.textAlign="center",a.font="bold 20px bangers","level"==gameMode?a.fillText("Level "+(currentLevelIndex+1)+" starts in "+Math.round(this.waitTime),Game.width/2,Game.height/2):a.fillText("Time Attack starts in "+Math.round(this.waitTime),Game.width/2,Game.height/2)}},GameEnded=function(){this.timeout=0,this.waitTime=3,this.step=function(a){this.timeout+=a,this.waitTime-=a,this.timeout>3&&startGame()},this.draw=function(a){a.fillStyle="#CCC",a.textAlign="center",a.font="bold 40px bangers",a.fillText("Game over",Game.width/2,Game.height/2)}},sprites={ship:{sx:110,sy:0,w:22,h:40,frames:1},missile:{sx:110,sy:40,w:7,h:20,frames:1},ballXL:{sx:50,sy:30,w:60,h:60,frames:1},ballL:{sx:0,sy:0,w:50,h:50,frames:1},ballM:{sx:0,sy:50,w:40,h:40,frames:1},ballS:{sx:50,sy:0,w:30,h:30,frames:1},ballXS:{sx:80,sy:0,w:20,h:20,frames:1},star:{sx:132,sy:30,w:30,h:30,frames:1},missile1:{sx:132,sy:0,w:30,h:30,frames:1},missile2:{sx:162,sy:0,w:30,h:30,frames:1},missile3:{sx:192,sy:0,w:30,h:30,frames:1},gravityH:{sx:162,sy:30,w:30,h:30,frames:1},gravityL:{sx:192,sy:30,w:30,h:30,frames:1},missileR1:{sx:132,sy:60,w:30,h:30,frames:1},missileR2:{sx:162,sy:60,w:30,h:30,frames:1},missileR3:{sx:192,sy:60,w:30,h:30,frames:1},ballXL_S:{sx:222,sy:0,w:20,h:20,frames:1},ballL_S:{sx:222,sy:20,w:20,h:20,frames:1},ballM_S:{sx:222,sy:40,w:20,h:20,frames:1}},OBJECT_PLAYER=1,OBJECT_PLAYER_PROJECTILE=2,OBJECT_BALL=4;OBJECT_SPECIALS=8,iOS=!1;var hits=0,gameMode="level",ballsOnScreen=0,currentLevelIndex=0,currentLevel=[],showNextBallTime=[],levelModeSpecialBalls=[],levelModeSpecialBallsWhenToShow=[],timeAttackLevel=["ballL","ballS"],timeAttackNewBallInterval=3,specialBallsAvailable=["missile1","missile2","missile3","missileR1","missileR2","missileR3","gravityH","gravityL","missile1","missile2","missileR1","missileR2","gravityH","gravityL"],timeAttackSpecialBalls,timeAttackLimit=60,noOfMissiles=1,ballSpeed=0,ballGravity=null,debugMode=!1,startGame=function(){Game.setBoard(1,new MainMenu),DrawBackgroundBalls()},nextLevel=function(){Game.clearBoard(),Game.setBoard(1,new LevelMenu(!0)),DrawBackgroundBalls()},levelFailed=function(){ballsOnScreen=0,Game.clearBoard(),Game.setBoard(1,new LevelMenu(!1)),DrawBackgroundBalls()},timeAttackEnded=function(){ballsOnScreen=0,Game.clearBoard(),Game.setBoard(1,new TimeAttackMenu),DrawBackgroundBalls()},playGame=function(){if(noOfMissiles=1,ballSpeed=0,ballGravity=null,hits=0,"level"==gameMode){currentLevel=levels[currentLevelIndex][0],showNextBallTime=levels[currentLevelIndex][1].slice(0),levelModeSpecialBalls=levels[currentLevelIndex][2].slice(0);for(var a=levelModeSpecialBalls.shift(),b=(Math.pow(2,a)-1)*(showNextBallTime.length+1),c=0,d=levelModeSpecialBalls.length;d>c;c++)levelModeSpecialBallsWhenToShow[c]=Math.round(Math.random()*b);levelModeSpecialBallsWhenToShow.sort(function(a,b){return a-b}),shuffle(levelModeSpecialBalls),console.log(levelModeSpecialBalls),console.log(levelModeSpecialBallsWhenToShow);var e=new GameBoard;e.add(new PlayerShip),e.add(new Balls(Game.width/2-25,0,90,currentLevel[0])),Game.setBoard(1,e)}else{timeAttackSpecialBalls=specialBallsAvailable.slice(0),shuffle(timeAttackSpecialBalls);var e=new GameBoard;e.add(new PlayerShip),e.add(new Balls(Game.width/2-25,0,90,timeAttackLevel[0])),Game.setBoard(1,e)}};window.addEventListener("load",function(){Game.initialize("game",sprites,startGame)});var Balls=function(a,b,c,d){this.x=a,this.y=b,this.predznakX=1,this.predznakY=1,this.ballType=d,this.angle=c*Math.PI/180,console.log(currentLevel[1]),ballGravity||("Timeout"==Game.animationLoop?(ballSpeed=2.5,ballGravity=.03):"ballXS"==currentLevel[1]?(ballSpeed=.5,ballGravity=.005):(ballSpeed=.7,ballGravity=.01)),console.log("Speed: "+ballSpeed),console.log("Gravity: "+ballGravity),this.velocityX=ballSpeed*Math.cos(this.angle),this.velocityY=ballSpeed*Math.sin(this.angle),this.w=SpriteSheet.map[this.ballType].w,this.h=SpriteSheet.map[this.ballType].h,ballsOnScreen+=1};Balls.prototype.step=function(){this.velocityY+=ballGravity,this.x+=this.velocityX*this.predznakX,this.y+=this.velocityY,"level"==gameMode?((this.x>Game.width-this.w||this.x<=0)&&(this.predznakX*=-1),this.y<0&&(this.y=0),this.y>Game.height-this.h&&levelFailed()):(this.x<=0-this.w||this.x>Game.width||this.y>Game.height-this.h)&&(this.board.remove(this),ballsOnScreen-=1)},Balls.prototype.draw=function(a){SpriteSheet.draw(a,this.ballType,this.x,this.y)},Balls.prototype.type=OBJECT_BALL;var PlayerShip=function(){this.w=SpriteSheet.map.ship.w,this.h=SpriteSheet.map.ship.h,this.x=Game.width/2-this.w/2,this.y=Game.height-Game.playerOffset-this.h,this.vx=0,this.reloadTime=.4,this.reload=this.reloadTime,this.maxVelocity=320,this.timeEllapsed=0,this.timeAttackNewBallTime=timeAttackNewBallInterval,this.timeAttackSpecialBallTime=4*Math.random()+3;var a=0,c=1*new Date-1;this.step=function(a){this.vx=Game.keys.left?-this.maxVelocity:Game.keys.right?this.maxVelocity:0,this.x+=this.vx*a,this.x<0?this.x=0:this.x>Game.width-this.w&&(this.x=Game.width-this.w);var b=this.board.collide(this,OBJECT_SPECIALS);if(b&&(this.board.remove(b),handleSpecials(this,b)),this.reload-=a,Game.keys.fire&&this.reload<0&&(this.reload=this.reloadTime,3==noOfMissiles?(this.board.add(new PlayerMissile(this.x,this.y+this.h/2)),this.board.add(new PlayerMissile(this.x+this.w/2-3,this.y)),this.board.add(new PlayerMissile(this.x+this.w-7,this.y+this.h/2))):2==noOfMissiles?(this.board.add(new PlayerMissile(this.x,this.y+this.h/2)),this.board.add(new PlayerMissile(this.x+this.w-7,this.y+this.h/2))):this.board.add(new PlayerMissile(this.x+this.w/2,this.y+this.h/2))),"level"==gameMode){if(0>=ballsOnScreen&&0==showNextBallTime.length&&(currentLevelIndex<levels.length-1?(currentLevelIndex+=1,nextLevel()):Game.setBoard(1,new GameEnded)),this.timeEllapsed+=a,showNextBallTime.length>0&&this.timeEllapsed>showNextBallTime[0]){showNextBallTime.shift();var c=SpriteSheet.map[currentLevel[0]].w,d=Math.round(Math.random()*(Game.width-c));this.board.add(new Balls(d,0,90,currentLevel[0]))}levelModeSpecialBalls.length>0&&levelModeSpecialBallsWhenToShow.length>0&&levelModeSpecialBallsWhenToShow[0]==hits&&(this.board.add(new Specials(Math.random()*(Game.width-30),0,levelModeSpecialBalls[0])),levelModeSpecialBalls.shift(),levelModeSpecialBallsWhenToShow.shift())}else{if(this.timeEllapsed+=a,this.timeEllapsed>timeAttackLimit)Game.clearBoard(),timeAttackEnded();else if(this.timeEllapsed>this.timeAttackNewBallTime){var e=3*Math.random()+1.5;this.timeAttackNewBallTime+=e;var c=SpriteSheet.map[timeAttackLevel[0]].w,d=Math.round(Math.random()*(Game.width-c));this.board.add(new Balls(d,0,90,timeAttackLevel[0]))}if(timeAttackSpecialBalls.length>0&&this.timeEllapsed>this.timeAttackSpecialBallTime){this.board.add(new Specials(Game.width/2,0,timeAttackSpecialBalls[0])),timeAttackSpecialBalls.shift();var e=5*Math.random()+6;console.log(e),this.timeAttackSpecialBallTime+=e}}},this.draw=function(b){SpriteSheet.draw(b,"ship",this.x,this.y,0),b.fillStyle="#FFFFFF",b.textAlign="center",b.font="bold 20px bangers";var d=0;if(iOS&&(d=20),debugMode){b.fillStyle="#888888",b.textAlign="left",b.font="bold 15px bangers";var e=this.board.objects.length;b.fillText("Objects active: "+e,5,20+d),b.fillText("Hits: "+hits,5,40+d);var f=1,g=1e3/((noow=new Date)-c);if(a+=(g-a)/f,c=noow,b.textAlign="right",b.fillText("FPS: "+Math.round(a),Game.width-5,20+d),b.fillText(Game.animationLoop,Game.width-5,40+d),"level"==gameMode)b.textAlign="left",b.fillText("Level "+(currentLevelIndex+1),5,60+d),b.textBaseline="top",b.fillText(showNextBallTime.length+"x",Game.width-28,60+d),SpriteSheet.draw(b,currentLevel[0]+"_S",Game.width-25,60+d,0);else{var h=timeAttackLimit-this.timeEllapsed;b.textAlign="left",b.fillText("Time: "+h.toFixed(2),5,60+d),5>=h&&(b.save(),b.globalAlpha=h-Math.floor(h),b.fillStyle="#F00",b.textAlign="center",b.textBaseline="middle",b.font="bold 100px arial",b.fillText(h.toFixed(1),Game.width/2,Game.height/2),b.restore())}}else{if(b.save(),"level"==gameMode)b.textAlign="left",b.fillText("Level "+(currentLevelIndex+1),5,20+d),b.textAlign="right",b.fillText(showNextBallTime.length+"x",Game.width-30,20+d),SpriteSheet.draw(b,currentLevel[0]+"_S",Game.width-25,2+d,0);else{var h=timeAttackLimit-this.timeEllapsed;b.textAlign="left",b.fillText("Time: "+h.toFixed(1),5,20+d),b.textAlign="right",b.fillText("Hits: "+hits,Game.width-5,20+d);var h=timeAttackLimit-this.timeEllapsed;5>=h&&(b.save(),b.globalAlpha=h-Math.floor(h),b.fillStyle="#F00",b.textAlign="center",b.textBaseline="middle",b.font="bold 100px arial",b.fillText(h.toFixed(1),Game.width/2,Game.height/2),b.restore())}b.restore()}},this.type=OBJECT_PLAYER},PlayerMissile=function(a,b){this.w=SpriteSheet.map.missile.w,this.h=SpriteSheet.map.missile.h,this.x=a-this.w/2,this.y=b-this.h,this.vy=-300};PlayerMissile.prototype.step=function(a){this.y+=this.vy*a,this.y<-this.h&&this.board.remove(this);var b=this.board.collide(this,OBJECT_BALL);if(b){if(noOfMissiles>1&&(ar=this.board.alreadyRemoved(b)))return;this.board.remove(b),this.board.remove(this),hits+=1,ballsOnScreen-=1;var c=b.w,d=this.x+this.w/2-Math.round(b.x+b.w/2),e=c/2;-1*e>d&&(d=-1*e),d>e&&(d=e);var f=60,g=Math.round(-1*f*(d/e)),h="ballL",i=!0;if("level"==gameMode){switch(b.ballType){case"ballXL":h="ballL","ballXL"==currentLevel[1]&&(i=!1);break;case"ballL":h="ballM","ballL"==currentLevel[1]&&(i=!1);break;case"ballM":h="ballS","ballM"==currentLevel[1]&&(i=!1);break;case"ballS":h="ballXS","ballS"==currentLevel[1]&&(i=!1);break;case"ballXS":h="ballL",i=!1}if(i){var j=this.x-c/2;0>j&&(j=0),this.board.add(new Balls(j,this.y-c/2,270+g-30,h)),this.board.add(new Balls(j,this.y-c/2,270+g+30,h))}}else{switch(b.ballType){case"ballXL":h="ballL","ballXL"==timeAttackLevel[1]&&(i=!1);break;case"ballL":h="ballM","ballL"==timeAttackLevel[1]&&(i=!1);break;case"ballM":h="ballS","ballM"==timeAttackLevel[1]&&(i=!1);break;case"ballS":h="ballXS","ballS"==timeAttackLevel[1]&&(i=!1);break;case"ballXS":h="ballL",i=!1}i&&(this.board.add(new Balls(this.x-c/2,this.y-c/2,270+g-30,h)),this.board.add(new Balls(this.x-c/2,this.y-c/2,270+g+30,h)))}}},PlayerMissile.prototype.draw=function(a){SpriteSheet.draw(a,"missile",this.x,this.y)},PlayerMissile.prototype.type=OBJECT_PLAYER_PROJECTILE;var levels=[[["ballM","ballS"],[],[]],[["ballM","ballS"],[2],[]],[["ballM","ballS"],[2,4],[]],[["ballM","ballS"],[2,3,5],[2,"missileR3"]],[["ballM","ballS"],[1,3,6,8],[2,"missile2","gravityL","missile1"]],[["ballM","ballS"],[1,3,6,8,10],[2,"gravityH","gravityL","missileR3"]],[["ballM","ballS"],[1,3,6,8,9,11],[2,"missile2","missileR1","missileR2"]],[["ballM","ballS"],[1,3,6,8,9,12,13,15],[2,"missile2","missileR1","missileR2","gravityH"]],[["ballM","ballS"],[1,3,6,8,9,12,13,15,17],[2,"missile2","missileR1","gravityH","gravityL","missile1"]],[["ballM","ballS"],[1,3,6,8,9,12,13,15,17,20],[2,"missile2","missileR1","gravityH","gravityL","missile1"]],[["ballM","ballS"],[1,3,6,8,9,12,13,15,18,19],[2,"missile2","missileR1","gravityH","gravityL","missile1"]],[["ballM","ballS"],[1,3,6,8,9,12,13,15,16,17,18],[2,"missileR1","missileR2","gravityH","gravityL"]],[["ballL","ballS"],[],[]],[["ballL","ballS"],[3],[3,"missile2"]],[["ballL","ballS"],[3,7],[3,"missile2","missileR1"]],[["ballL","ballS"],[2,5,8],[3,"missile2","missileR1","missileR3"]],[["ballL","ballS"],[2,5,8,11],[3,"missile2","missileR1","missileR2","gravityL"]],[["ballL","ballS"],[2,5,8,11,14],[3,"missile3","missileR1","missileR3","gravityH","gravityL"]],[["ballL","ballS"],[2,5,8,11,14,18],[3,"missile2","missileR1","missileR2"]],[["ballL","ballS"],[2,5,8,11,14,18,22],[3,"missile2","missile1","missileR1","missileR2","gravityL"]],[["ballL","ballS"],[2,5,8,11,14,18,21,25],[3,"missile2","missileR1","missileR3","gravityL"]],[["ballL","ballS"],[2,5,8,11,14,18,21,23,25],[3,"missile2","missileR1","missileR3","gravityL","gravityH"]],[["ballL","ballS"],[2,5,8,11,14,18,21,24,26,28],[3,"missile2","missileR1","missileR3","gravityL","gravityH","missile1"]],[["ballL","ballS"],[2,5,8,11,14,18,21,24,26,28,30],[3,"missile2","missileR1","missileR2","gravityL","missile3"]],[["ballXL","ballS"],[],[4,"missile2","missileR1","gravityL"]],[["ballXL","ballS"],[8],[4,"missileR1","missileR3","gravityL"]],[["ballXL","ballS"],[7,14],[4,"missile2","missileR1","gravityL","gravityH"]],[["ballXL","ballS"],[7,13,20],[4,"gravityL","gravityH","missileR3","missile1","missileR2"]],[["ballXL","ballS"],[6,13,20,25],[4,"missile2","missileR1","missileR3","missile1","missileR2"]],[["ballXL","ballS"],[6,13,20,25,31],[4,"missile2","missileR1","missileR3","missile1","missileR2","gravityL"]],[["ballXL","ballS"],[6,13,20,25,30,37],[4,"missile2","missileR1","missileR3","missile1","missileR2"]],[["ballXL","ballS"],[6,13,20,25,30,35],[4,"missile2","missileR1","missileR3","missile1","missileR2","gravityL"]],[["ballXL","ballS"],[6,13,20,25,30,37,40],[4,"missile2","missileR1","missileR3","missile1","missileR2","gravityH"]],[["ballXL","ballS"],[6,13,20,25,30,37,42,45],[4,"missile2","missileR1","missileR3","missile1","missileR2","gravityL"]],[["ballXL","ballXS"],[],[5,"missile2","missileR1","missileR3","gravityH","gravityL"]],[["ballXL","ballXS"],[12],[5,"missile2","missileR1","missileR3","gravityH","gravityL"]],[["ballXL","ballXS"],[12,25],[5,"missile2","missile2","missileR1","missileR2","missileR3","gravityH","gravityL"]],[["ballXL","ballXS"],[12,25,35],[5,"missile2","missile2","missileR1","missile3","missileR2","missileR3","missile3","missileR2","missileR3","gravityH","gravityL"]],[["ballXL","ballXS"],[12,25,33],[5,"missile2","missile2","missileR1","missile3","missileR2","missileR3","missile3","missileR2","missileR3","gravityH","gravityL"]],[["ballXL","ballXS"],[12,25,33,40],[5,"missile2","missile2","missileR1","missileR3","missile3","missileR3","missile3","missileR2","missileR3","gravityH","gravityL"]],[["ballXL","ballXS"],[12,25,33,40,47],[5,"missile2","missile2","missileR1","missileR3","missile3","missileR3","missile3","missileR2","missileR3","gravityH","gravityL"]],[["ballXL","ballXS"],[12,25,33,40,47,50],[5,"missile2","missile2","missileR1","missileR3","missile3","missileR3","missile3","missileR2","missileR3","gravityH","gravityL"]],[["ballXL","ballXS"],[12,25,33,40,47,50,55],[5,"missile2","missile2","missileR1","missileR3","missile3","missileR3","missile3","missileR2","missileR3","gravityH","gravityL"]],[["ballXL","ballXS"],[12,25,33,40,47,50,54],[5,"missile2","missile2","missileR1","missileR3","missile3","missileR3","missile3","missileR2","missileR3","gravityH","gravityL"]]],noOfButtons=5,marginLeftRight=25,marginTopBottom=15,drawMenuButton=function(a,b,c){var d=Game.width-2*marginLeftRight,e=Game.height/noOfButtons-2*marginTopBottom,f=Game.height/noOfButtons;a.save(),a.globalAlpha=.9,a.fillStyle="#555",a.fillRect(marginLeftRight,f*b+marginTopBottom,d,e),a.fillStyle="#333",a.fillRect(marginLeftRight+5,f*b+marginTopBottom+5,d-10,e-10),a.textAlign="center",a.textBaseline="middle",a.globalAlpha=1,a.font="bold 30px arial",a.fillStyle="#CCC",a.fillText(c,Game.width/2,f*b+f/2),a.restore()},drawMenuLabel=function(a,b,c){Game.width-2*marginLeftRight,Game.height/noOfButtons-2*marginTopBottom;var f=Game.height/noOfButtons;a.save(),a.textAlign="center",a.textBaseline="middle",a.font="bold 40px arial",a.fillStyle="#CCC","CLEARED"==c&&(a.fillStyle="#0F0",a.font="bold 30px arial"),"FAILED"==c&&(a.fillStyle="#F00",a.font="bold 30px arial"),a.fillText(c,Game.width/2,f*b+f/2),a.restore()},MainMenu=function(){var a=Game.height/noOfButtons;currentLevelIndex=0,hits=0,this.step=function(){},this.draw=function(a){drawMenuLabel(a,0,"Split ball"),drawMenuButton(a,1,"Marathon"),drawMenuButton(a,2,"Time Attack"),drawMenuButton(a,3,"Help")},Game.isMobile?(tTouch=function(b){var c,d,e;b.preventDefault();for(var f=0;f<b.targetTouches.length;f++)c=b.targetTouches[f],d=c.pageX/Game.canvasMultiplier-Game.canvas.offsetLeft,e=c.pageY/Game.canvasMultiplier-Game.canvas.offsetTop,d>marginLeftRight&&d<Game.width-marginLeftRight&&e>a+marginTopBottom&&2*a-marginTopBottom>e?(Game.canvas.removeEventListener("touchstart",tTouch,!1),Game.clearBoard(),gameMode="level",Game.setBoard(1,new HomeScreen(playGame)),Game.setBoard(2,new TouchControls)):d>marginLeftRight&&d<Game.width-marginLeftRight&&e>2*a+marginTopBottom&&3*a-marginTopBottom>e?(Game.canvas.removeEventListener("touchstart",tTouch,!1),Game.clearBoard(),gameMode="time",Game.setBoard(1,new HomeScreen(playGame)),Game.setBoard(2,new TouchControls)):d>marginLeftRight&&d<Game.width-marginLeftRight&&e>3*a+marginTopBottom&&4*a-marginTopBottom>e&&(Game.canvas.removeEventListener("touchstart",tTouch,!1),Game.clearBoard(),Game.setBoard(1,new HelpMenu))},Game.canvas.addEventListener("touchstart",tTouch,!1)):(tClick=function(b){b.preventDefault(),b.clientX;var d=b.clientY;d>a+marginTopBottom&&2*a-marginTopBottom>d?(Game.canvas.removeEventListener("click",tClick,!1),Game.clearBoard(),gameMode="level",Game.setBoard(1,new HomeScreen(playGame))):d>2*a+marginTopBottom&&3*a-marginTopBottom>d?(Game.canvas.removeEventListener("click",tClick,!1),Game.clearBoard(),gameMode="time",Game.setBoard(1,new HomeScreen(playGame))):d>3*a+marginTopBottom&&4*a-marginTopBottom>d&&(Game.canvas.removeEventListener("click",tClick,!1),Game.clearBoard(),Game.setBoard(1,new HelpMenu))},Game.canvas.addEventListener("click",tClick,!1))},LevelMenu=function(a){var b=Game.height/noOfButtons;this.step=function(){},this.draw=function(b){a?(drawMenuLabel(b,0,"Level "+currentLevelIndex),drawMenuLabel(b,1,"CLEARED"),drawMenuButton(b,2,"Next level")):(drawMenuLabel(b,0,"Level "+(currentLevelIndex+1)),drawMenuLabel(b,1,"FAILED"),drawMenuButton(b,2,"Retry level")),drawMenuButton(b,3,"Main menu")},Game.isMobile?(tTouch=function(a){var c,d,e;a.preventDefault();for(var f=0;f<a.targetTouches.length;f++)c=a.targetTouches[f],d=c.pageX/Game.canvasMultiplier-Game.canvas.offsetLeft,e=c.pageY/Game.canvasMultiplier-Game.canvas.offsetTop,d>marginLeftRight&&d<Game.width-marginLeftRight&&e>2*b+marginTopBottom&&3*b-marginTopBottom>e?(Game.canvas.removeEventListener("touchstart",tTouch,!1),Game.clearBoard(),Game.setBoard(1,new HomeScreen(playGame)),Game.setBoard(2,new TouchControls)):d>marginLeftRight&&d<Game.width-marginLeftRight&&e>3*b+marginTopBottom&&4*b-marginTopBottom>e&&(Game.canvas.removeEventListener("touchstart",tTouch,!1),Game.setBoard(1,new MainMenu))},Game.canvas.addEventListener("touchstart",tTouch,!1)):(tClick=function(a){a.preventDefault(),a.clientX;var d=a.clientY;d>2*b+marginTopBottom&&3*b-marginTopBottom>d?(Game.canvas.removeEventListener("click",tClick,!1),Game.clearBoard(),Game.setBoard(1,new HomeScreen(playGame))):d>3*b+marginTopBottom&&4*b-marginTopBottom>d&&(Game.canvas.removeEventListener("click",tClick,!1),Game.setBoard(1,new MainMenu))},Game.canvas.addEventListener("click",tClick,!1))},TimeAttackMenu=function(){var a=Game.height/noOfButtons;this.step=function(){},this.draw=function(a){drawMenuLabel(a,0,"Time attack"),drawMenuLabel(a,1,"HITS: "+hits),drawMenuButton(a,2,"Try again"),drawMenuButton(a,3,"Main menu")},Game.isMobile?(tTouch=function(b){var c,d,e;b.preventDefault();for(var f=0;f<b.targetTouches.length;f++)c=b.targetTouches[f],d=c.pageX/Game.canvasMultiplier-Game.canvas.offsetLeft,e=c.pageY/Game.canvasMultiplier-Game.canvas.offsetTop,d>marginLeftRight&&d<Game.width-marginLeftRight&&e>2*a+marginTopBottom&&3*a-marginTopBottom>e?(Game.canvas.removeEventListener("touchstart",tTouch,!1),Game.clearBoard(),hits=0,Game.setBoard(1,new HomeScreen(playGame)),Game.setBoard(2,new TouchControls)):d>marginLeftRight&&d<Game.width-marginLeftRight&&e>3*a+marginTopBottom&&4*a-marginTopBottom>e&&(Game.canvas.removeEventListener("touchstart",tTouch,!1),Game.setBoard(1,new MainMenu))},Game.canvas.addEventListener("touchstart",tTouch,!1)):(tClick=function(b){b.preventDefault(),b.clientX;var d=b.clientY;d>2*a+marginTopBottom&&3*a-marginTopBottom>d?(Game.canvas.removeEventListener("click",tClick,!1),Game.clearBoard(),Game.setBoard(1,new HomeScreen(playGame))):d>3*a+marginTopBottom&&4*a-marginTopBottom>d&&(Game.canvas.removeEventListener("click",tClick,!1),Game.setBoard(1,new MainMenu))},Game.canvas.addEventListener("click",tClick,!1))},BackgroundBalls=function(a,b,c,d,e){this.ballType=c,this.x=a,this.y=b,this.predznakX=1,this.predznakY=1,this.w=SpriteSheet.map[c].w+5,this.step=function(){this.x+=d*this.predznakX,this.y+=e*this.predznakY,(this.x>Game.width-this.w||this.x<=0)&&(this.predznakX*=-1),(this.y>Game.height-this.w||this.y<=0)&&(this.predznakY*=-1)},this.draw=function(a){SpriteSheet.draw(a,this.ballType,this.x,this.y)}},DrawBackgroundBalls=function(){for(var a=new GameBoard,b=Game.width-60,c=Game.height-60,d=["ballXL","ballL","ballM","ballM","ballS","ballS","ballXS","ballXS","ballXS"],e=0,f=d.length;f>e;e++)a.add(new BackgroundBalls(Math.random()*b,Math.random()*c,d[e],3*Math.random()+.1,3*Math.random()+.1));Game.setBoard(0,a)},HelpMenu=function(){var a=10,b=Game.height/a,c=["Fire one missile at once.","Fire two missiles at once.","Fire three missiles at once.","High gravity effect on balls.","Low gravity effect on balls.","Slow fire missile interval.","Medium fire missile interval.","Fast fire missile interval."],d=["missile1","missile2","missile3","gravityH","gravityL","missileR1","missileR2","missileR3"];this.step=function(){},this.draw=function(e){e.save(),e.font="bold 30px arial",e.textAlign="center",e.fillStyle="#CCC",e.fillText("Help",Game.width/2,b/2+10);for(var f=0,g=c.length;g>f;f++)e.font="bold 17px arial",e.textAlign="left",e.textBaseline="top",e.fillText(c[f],70,b*(f+1)+b/4),SpriteSheet.draw(e,d[f],20,b*(f+1)+b/4,0);e.globalAlpha=.9,e.fillStyle="#555",e.fillRect(Game.width/4,b*(a-1),Game.width/2,b-5),e.fillStyle="#333",e.fillRect(Game.width/4+5,b*(a-1)+5,Game.width/2-10,b-15),e.textAlign="center",e.textBaseline="middle",e.globalAlpha=1,e.font="bold 30px arial",e.fillStyle="#CCC",e.fillText("Back",Game.width/2,b*(a-1)+b/2),e.restore()},Game.isMobile?(tTouch=function(c){var d,e,f;c.preventDefault();for(var g=0;g<c.targetTouches.length;g++)d=c.targetTouches[g],e=d.pageX/Game.canvasMultiplier-Game.canvas.offsetLeft,f=d.pageY/Game.canvasMultiplier-Game.canvas.offsetTop,e>Game.width/4&&e<3*Game.width/4&&f>b*(a-1)&&b*a>f&&(Game.canvas.removeEventListener("touchstart",tTouch,!1),DrawBackgroundBalls(),Game.setBoard(1,new MainMenu))},Game.canvas.addEventListener("touchstart",tTouch,!1)):(tClick=function(c){c.preventDefault(),c.clientX;var e=c.clientY;e>b*(a-1)&&b*a>e&&(Game.canvas.removeEventListener("click",tClick,!1),DrawBackgroundBalls(),Game.setBoard(1,new MainMenu))},Game.canvas.addEventListener("click",tClick,!1))},Specials=function(a,b,c){this.x=a,this.y=b,this.w=SpriteSheet.map[c].w,this.h=SpriteSheet.map[c].h,this.specialsType=c};Specials.prototype.step=function(){this.y+=1.5,this.y>Game.height-this.h&&this.board.remove(this)},Specials.prototype.draw=function(a){SpriteSheet.draw(a,this.specialsType,this.x,this.y)},Specials.prototype.type=OBJECT_SPECIALS;var handleSpecials=function(a,b){"star"==b.specialsType||("missile1"==b.specialsType?noOfMissiles=1:"missile2"==b.specialsType?noOfMissiles=2:"missile3"==b.specialsType?noOfMissiles=3:"gravityH"==b.specialsType?ballGravity=.02:"gravityL"==b.specialsType?ballGravity=.001:"missileR1"==b.specialsType?a.reloadTime=.6:"missileR2"==b.specialsType?a.reloadTime=.4:"missileR3"==b.specialsType&&(a.reloadTime=.2))};